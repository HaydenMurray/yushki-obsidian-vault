<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baseline - Tactical Tile Game</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Georgia, serif;
            background: #0a0a0f;
            color: #ddd;
        }
        * {
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef, useMemo } = React;

        const G=4,TOTAL=16,DECK=40,MIN_BL=8;
        const TT={blank:{n:"Blank",i:"â—»",c:"#3a3a4a",t:"blank"},sword:{n:"Sword",i:"âš”ï¸",c:"#e74c3c",t:"direct"},bow:{n:"Bow",i:"ğŸ¹",c:"#2ecc71",t:"direct"},dagger:{n:"Daggers",i:"ğŸ—¡ï¸",c:"#9b59b6",t:"direct"},flail:{n:"Flail",i:"â›“ï¸",c:"#e67e22",t:"direct"},trap:{n:"Trap",i:"ğŸª¤",c:"#795548",t:"attack"},prayer:{n:"Prayer",i:"ğŸ™",c:"#f1c40f",t:"buff"},fireball:{n:"Fireball",i:"ğŸ”¥",c:"#ff5722",t:"attack"},bloodthirst:{n:"Bloodthirst",i:"ğŸ©¸",c:"#c0392b",t:"buff"},healing:{n:"Healing",i:"ğŸ’š",c:"#27ae60",t:"buff"},shield:{n:"Shield",i:"ğŸ›¡ï¸",c:"#3498db",t:"buff"},staff:{n:"Staff",i:"ğŸª„",c:"#8e44ad",t:"direct"},dodge:{n:"Dodge",i:"ğŸ’¨",c:"#1abc9c",t:"buff"},silence:{n:"Silence",i:"ğŸ¤«",c:"#34495e",t:"debuff"}};
        const CONS={minor_heal:{n:"Minor Heal",i:"ğŸ§ª",d:"Heal 10%",p:80},swiftness:{n:"Swiftness",i:"âš¡",d:"Move twice",p:150},heal_potion:{n:"Heal Pot",i:"â¤ï¸â€ğŸ©¹",d:"Heal 20%",p:180},preparation:{n:"Prepare",i:"âš”ï¸",d:"2x DMG",p:200},incarnate:{n:"Incarnate",i:"ğŸŒŸ",d:"Fill blanks",p:250},petrify:{n:"Petrify",i:"ğŸ—¿",d:"Immune 1t",p:200},shuffle_c:{n:"Shuffle",i:"ğŸ”„",d:"Reshuffle",p:220},stunning:{n:"Stun All",i:"âš¡",d:"Stun all",p:250}};
        const CLS={shieldmaiden:{name:"Shieldmaiden",icon:"ğŸ›¡ï¸",color:"#3498db",moveD:"V & H 1 tile",hp:[100,150,200],dmg:[50,70,100],spec:"Blanks â†’ Shield",specD:"Blanks become shield tiles"},rogue:{name:"Rogue",icon:"ğŸ—¡ï¸",color:"#9b59b6",moveD:"Jump over 1 V&H",hp:[80,120,170],dmg:[60,90,120],spec:"Blanks â†’ +30% ATK",specD:"Each blank boosts next attack 30%"},wanderer:{name:"Wanderer",icon:"ğŸ§­",color:"#e67e22",moveD:"Diagonal 1 tile",hp:[75,120,180],dmg:[60,80,110],spec:"Blanks â†’ Shift",specD:"Blanks randomly move you"},knight:{name:"Knight",icon:"â™",color:"#c0392b",moveD:"Chess L-shape",hp:[120,170,220],dmg:[50,70,90],spec:"Heals per tile",specD:"Heals per tile traveled"}};
        const ETIERS={melee:[{t:"I",hp:[100,120,140,180,220],dmg:[20,25,30,50,70]},{t:"II",hp:[120,140,180,220,300],dmg:[25,30,50,70,100]},{t:"III",hp:[140,180,220,300,500],dmg:[30,50,70,100,150]}],ranged:[{t:"I",hp:[100,120,140,180,220],dmg:[10,15,20,30,45]},{t:"II",hp:[120,140,180,220,300],dmg:[15,20,30,45,65]},{t:"III",hp:[140,180,220,300,400],dmg:[20,30,45,65,100]}]};
        const EMODS={none:{n:"",i:"",c:""},thorns:{n:"Thorns",i:"ğŸŒµ",c:"#27ae60"},enrage:{n:"Enrage",i:"ğŸ˜¡",c:"#e74c3c"},shield:{n:"Shield",i:"ğŸ›¡",c:"#3498db"},agile:{n:"Agile",i:"ğŸ’¨",c:"#1abc9c"}};
        const cl=(v,a,b)=>Math.max(a,Math.min(b,v));const ri=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;const pk=a=>a[Math.floor(Math.random()*a.length)];const shu=a=>{const r=[...a];for(let i=r.length-1;i>0;i--){const j=ri(0,i);[r[i],r[j]]=[r[j],r[i]];}return r;};const uid=()=>Math.random().toString(36).slice(2,9);
        function buildDeck(ch){const d=[];for(let i=0;i<MIN_BL;i++)d.push("blank");const av=ch.filter(t=>t!=="blank");for(let i=0;i<DECK-MIN_BL;i++)d.push(pk(av));return shu(d);}
        function adj(x){const r=Math.floor(x/G),c=x%G,a=[];if(r>0)a.push(x-G);if(r<G-1)a.push(x+G);if(c>0)a.push(x-1);if(c<G-1)a.push(x+1);return a;}
        function diag(x){const r=Math.floor(x/G),c=x%G,a=[];if(r>0&&c>0)a.push(x-G-1);if(r>0&&c<G-1)a.push(x-G+1);if(r<G-1&&c>0)a.push(x+G-1);if(r<G-1&&c<G-1)a.push(x+G+1);return a;}
        function knightM(x){const r=Math.floor(x/G),c=x%G;return[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].map(([dr,dc])=>[r+dr,c+dc]).filter(([nr,nc])=>nr>=0&&nr<G&&nc>=0&&nc<G).map(([nr,nc])=>nr*G+nc);}
        function jumpM(x){const r=Math.floor(x/G),c=x%G,j=[];if(r>=2)j.push(x-2*G);if(r<=G-3)j.push(x+2*G);if(c>=2)j.push(x-2);if(c<=G-3)j.push(x+2);return j;}
        function cluster(tiles,x){const tt=tiles[x];if(!tt||tt==="blank")return[x];const vis=new Set([x]),q=[x];while(q.length){const cur=q.shift();for(const a of adj(cur)){if(!vis.has(a)&&tiles[a]===tt){vis.add(a);q.push(a);}}}return[...vis];}
        function vMov(pos,cls,dbl){let m;switch(cls){case"shieldmaiden":m=adj(pos);break;case"rogue":m=jumpM(pos);break;case"wanderer":m=diag(pos);break;case"knight":m=knightM(pos);break;default:m=adj(pos);}if(dbl){const ext=new Set(m);for(const p of m){let e2;switch(cls){case"shieldmaiden":e2=adj(p);break;case"rogue":e2=jumpM(p);break;case"wanderer":e2=diag(p);break;case"knight":e2=knightM(p);break;default:e2=adj(p);}e2.forEach(x=>ext.add(x));}ext.delete(pos);return[...ext];}return m;}
        function spawnW(lvl){const en=[];const cnt=Math.min(2+Math.floor(lvl/2),5);const ti=cl(Math.floor(lvl/3),0,2);for(let i=0;i<cnt;i++){const isR=Math.random()<0.35;const td=(isR?ETIERS.ranged:ETIERS.melee)[ti];const li=cl(Math.floor(lvl/2),0,4);const mod=lvl>=3&&Math.random()<0.3?pk(Object.keys(EMODS).filter(k=>k!=="none")):"none";en.push({id:uid(),type:isR?"ranged":"melee",tier:td.t,maxHp:td.hp[li],hp:td.hp[li],dmg:td.dmg[li],modifier:mod,stunned:0,silenced:0,burning:0,burnDmg:0,enraged:false,charging:isR&&Math.random()<0.4,chargeT:isR?ri(1,3):0});}return en;}
        const GCSS = `@keyframes floatUp{0%{opacity:1;transform:translateY(0) scale(1)}20%{opacity:1;transform:translateY(-14px) scale(1.3)}100%{opacity:0;transform:translateY(-70px) scale(0.6)}}@keyframes sShake{0%,100%{transform:translate(0,0)}15%{transform:translate(-3px,-2px)}35%{transform:translate(4px,1px)}55%{transform:translate(-2px,3px)}75%{transform:translate(3px,-1px)}}@keyframes bShake{0%,100%{transform:translate(0,0)}15%{transform:translate(-6px,-4px)}35%{transform:translate(7px,3px)}55%{transform:translate(-5px,5px)}75%{transform:translate(6px,-3px)}}@keyframes eHit{0%,100%{transform:scale(1);filter:brightness(1)}15%{transform:scale(1.18);filter:brightness(2.8)}35%{transform:scale(0.92);filter:brightness(1.5)}55%{transform:scale(1.06)}}@keyframes eIdle{0%,100%{transform:translateY(0)}50%{transform:translateY(-2px)}}@keyframes pMov{0%,100%{opacity:0.35;transform:scale(0.6)}50%{opacity:1;transform:scale(1.4)}}@keyframes healP{0%{box-shadow:0 0 0 0 #27ae6088}50%{box-shadow:0 0 24px 10px #27ae6044}100%{box-shadow:0 0 0 0 #27ae6000}}@keyframes shieldP{0%{box-shadow:0 0 0 0 #3498db88}50%{box-shadow:0 0 24px 10px #3498db44}100%{box-shadow:0 0 0 0 #3498db00}}@keyframes dmgF{0%,100%{background:#10101a}25%{background:#e74c3c28}}@keyframes sLog{from{opacity:0;transform:translateX(8px)}to{opacity:1;transform:translateX(0)}}@keyframes gTitle{0%,100%{text-shadow:0 0 40px #c9983866,0 0 80px #c9983822}50%{text-shadow:0 0 60px #c9983aaa,0 0 100px #c9983855}}@keyframes lvlB{0%{opacity:0;transform:translateY(-20px) scale(0.8)}20%{opacity:1;transform:scale(1.06)}80%{opacity:1}100%{opacity:0;transform:translateY(12px) scale(0.85)}}`;
        function Floats({texts}){return(<div style={{position:"absolute",inset:0,pointerEvents:"none",zIndex:50,overflow:"visible"}}>{texts.map(t=><div key={t.id} style={{position:"absolute",left:t.x,top:t.y,fontSize:t.sz||16,fontWeight:900,color:t.cl||"#fff",textShadow:`0 0 10px ${t.cl||"#fff"},0 2px 6px rgba(0,0,0,0.9)`,animation:"floatUp 1.2s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap",fontFamily:"Georgia,serif",letterSpacing:1}}>{t.tx}</div>)}</div>);}
        
        function BaselineGame(){
            const [screen,setScreen]=useState("title");const [selC,setSelC]=useState(null);const [deckC,setDeckC]=useState(["sword","shield","healing","prayer","fireball"]);const [gs,setGs]=useState(null);const [log,setLog]=useState([]);const [anim,setAnim]=useState(null);const [hlT,setHlT]=useState([]);const [showDk,setShowDk]=useState(false);const [shopO,setShopO]=useState(false);const logR=useRef(null);const [fts,setFts]=useState([]);const [shake,setShake]=useState(null);const [hitE,setHitE]=useState(new Set());const [pFl,setPFl]=useState(null);const [ban,setBan]=useState(null);
            const aLog=useCallback(m=>{setLog(p=>[...p.slice(-50),{id:uid(),msg:m}]);},[]);useEffect(()=>{if(logR.current)logR.current.scrollTop=logR.current.scrollHeight;},[log]);
            const spF=useCallback((tx,cl2,zone,sz)=>{const x=ri(20,280),y=zone==="e"?ri(5,60):ri(30,300);setFts(p=>[...p,{id:uid(),tx,cl:cl2,x,y,sz:sz||16}]);setTimeout(()=>setFts(p=>p.slice(1)),1400);},[]);
            const doSk=useCallback(t=>{setShake(t);setTimeout(()=>setShake(null),t==="b"?500:300);},[]);
            const flE=useCallback(id=>{setHitE(p=>{const n=new Set(p);n.add(id);return n;});setTimeout(()=>setHitE(p=>{const n=new Set(p);n.delete(id);return n;}),450);},[]);
            const flP=useCallback(t=>{setPFl(t);setTimeout(()=>setPFl(null),600);},[]);
            const sBan=useCallback(t=>{setBan(t);setTimeout(()=>setBan(null),1800);},[]);
            const startG=useCallback(()=>{if(!selC)return;const c=CLS[selC];const deck=buildDeck(deckC);const dr=[...deck];const fl=dr.splice(0,TOTAL);setGs({level:1,turn:1,pPos:12,maxHp:c.hp[0],hp:c.hp[0],bDmg:c.dmg[0],crit:5,shA:0,dodC:0,prB:0,bld:false,preB:0,lDag:false,dblM:false,pet:false,tTrav:0,cName:selC,cLvl:1,xp:0,xpN:100,gold:50,cons:[{...CONS.minor_heal,id:uid(),key:"minor_heal"}],maxC:3,floor:fl,drP:dr,diP:[],enemies:spawnW(1),traps:[],gameO:false,vic:false,tL:0});setLog([]);aLog("âš” Level 1!");setScreen("game");sBan("âš” LEVEL 1 âš”");},[selC,deckC,aLog,sBan]);
            const rFloor=useCallback(s=>{let dr=[...s.drP],di=[...s.diP,...s.floor],fl;if(dr.length>=TOTAL){fl=dr.splice(0,TOTAL);}else{dr=shu([...dr,...di]);di=[];fl=dr.splice(0,Math.min(TOTAL,dr.length));while(fl.length<TOTAL)fl.push("blank");}return{...s,floor:fl,drP:dr,diP:di};},[]);
            const dDmg=useCallback((s,dmg,mode,lf)=>{let st={...s};st.enemies=[...st.enemies.map(e=>({...e}))];let hl=0;if(!st.enemies.length)return st;const hit=(e,amt)=>{const ac=Math.min(e.hp,amt);e.hp-=ac;flE(e.id);spF(`-${ac}`,e.hp<=0?"#ff6b6b":"#ff4444","e",ac>=80?24:18);if(e.hp<=0)spF("ğŸ’€ KILLED","#ffaa00","e",20);if(e.modifier==="thorns"){const r=Math.floor(amt*0.1);st.hp-=r;lf(`ğŸŒµ ${r}`);spF(`ğŸŒµ-${r}`,"#27ae60","b",14);}if(e.modifier==="enrage")e.enraged=true;if(st.bld)hl+=Math.floor(ac*0.1);};if(mode==="first"){const t=st.enemies.find(e=>e.hp>0);if(t)hit(t,dmg);}else if(mode==="pierce"){st.enemies.forEach(e=>{if(e.hp>0)hit(e,dmg);});}else if(mode==="stun"){const t=st.enemies.find(e=>e.hp>0);if(t){hit(t,dmg);t.stunned=Math.max(t.stunned,1);spF("âš¡STUN","#f1c40f","e",15);}}else{const t=st.enemies.find(e=>e.hp>0);if(t)hit(t,dmg);}if(hl>0){st.hp=Math.min(st.maxHp,st.hp+hl);lf(`ğŸ©¸ +${hl}`);spF(`+${hl}`,"#c0392b","b",14);flP("h");}st.enemies=st.enemies.filter(e=>e.hp>0);doSk("s");return st;},[flE,spF,doSk,flP]);
            const rTile=useCallback((s,type,cnt,lf)=>{let st={...s};const base=st.bDmg+st.prB;const eff=st.preB>0?base*(1+st.preB):base;const isC=Math.random()*100<st.crit;const cm=isC?2:1;let td;if(isC)spF("âš¡ CRIT!","#f1c40f","b",22);switch(type){case"sword":td=Math.floor(eff*cnt*cm);lf(`âš”ï¸ Sword${isC?" CRIT!":""} ${td}`);st=dDmg(st,td,"first",lf);break;case"bow":td=Math.floor(eff*0.7*cnt*cm);lf(`ğŸ¹ Pierce ${td}`);st=dDmg(st,td,"pierce",lf);break;case"dagger":{const b=st.lDag?1.2:1;td=Math.floor(eff*b*cnt*cm);lf(`ğŸ—¡ï¸${st.lDag?" Combo!":""} ${td}`);if(st.lDag)spF("COMBO!","#9b59b6","b",20);st=dDmg(st,td,"first",lf);st.lDag=true;break;}case"flail":td=Math.floor(eff*0.8*cnt*cm);lf(`â›“ï¸ Flail ${td}`);st=dDmg(st,td,"stun",lf);break;case"trap":{const tc=cnt>=5?cnt:cnt>=4?cnt-2:cnt>=3?2:cnt>=2?1:0;for(let i=0;i<tc;i++)st.traps=[...st.traps,{dmg:Math.floor(eff*0.75)}];lf(`ğŸª¤ ${tc} trap(s)`);spF(`ğŸª¤Ã—${tc}`,"#795548","b",16);break;}case"prayer":{const pa=Math.floor(eff*0.2*cnt);st.prB+=pa;lf(`ğŸ™ +${pa}`);spF(`ğŸ™+${pa}`,"#f1c40f","b",16);break;}case"fireball":{const dpt=cnt>=6?eff*0.5*cnt:cnt>=5?eff:cnt>=4?eff*0.6:cnt>=3?eff*0.3:0;if(dpt>0&&st.enemies.length){st.enemies=[...st.enemies.map(e=>({...e}))];const t=st.enemies.find(e=>e.hp>0);if(t){t.burning=3;t.burnDmg=Math.floor(dpt);lf(`ğŸ”¥ Burn ${Math.floor(dpt)}/t`);spF(`ğŸ”¥${Math.floor(dpt)}`,"#ff5722","e",18);}}break;}case"bloodthirst":st.bld=true;lf("ğŸ©¸ Lifesteal!");spF("ğŸ©¸STEAL","#c0392b","b",16);break;case"healing":{const pct=cnt>=6?0.5+0.2*(cnt-5):cnt>=5?0.5:cnt>=4?0.3:cnt>=3?0.2:0;const h=Math.floor(st.maxHp*pct);st.hp=Math.min(st.maxHp,st.hp+h);lf(`ğŸ’š +${h}`);spF(`+${h} HP`,"#27ae60","b",20);flP("h");break;}case"shield":{const sa=Math.floor(st.maxHp*0.15*cnt);st.shA+=sa;lf(`ğŸ›¡ï¸ +${sa}`);spF(`ğŸ›¡+${sa}`,"#3498db","b",18);flP("s");break;}case"staff":td=Math.floor(eff*0.7*cnt*cm);lf(`ğŸª„ Staff ${td}`);st=dDmg(st,td,"first",lf);break;case"dodge":st.dodC+=10*cnt;lf(`ğŸ’¨ +${10*cnt}%`);spF(`ğŸ’¨+${10*cnt}%`,"#1abc9c","b",16);break;case"silence":if(st.enemies.length){st.enemies=[...st.enemies.map(e=>({...e}))];const t=st.enemies.find(e=>e.hp>0&&!e.silenced);if(t){t.silenced=cnt;lf(`ğŸ¤« ${cnt}t`);spF("ğŸ¤«SILENCE","#34495e","e",16);}}break;default:break;}if(["sword","bow","dagger","flail","staff"].includes(type)){st.prB=0;st.preB=0;if(type!=="dagger")st.lDag=false;}return st;},[dDmg,spF,flP]);
            const eTurn=useCallback((s,lf)=>{let st={...s};st.enemies=[...st.enemies.map(e=>({...e}))];let tD=0;for(const e of st.enemies){if(e.burning>0){e.hp-=e.burnDmg;lf(`ğŸ”¥ Burn ${e.burnDmg}`);e.burning--;spF(`ğŸ”¥-${e.burnDmg}`,"#ff5722","e",13);flE(e.id);}if(e.stunned>0){e.stunned--;continue;}if(e.silenced>0){e.silenced--;continue;}if(e.charging&&e.chargeT>0){e.chargeT--;continue;}let ed=e.dmg;if(e.enraged){ed=Math.floor(ed*1.2);e.enraged=false;}if(e.modifier==="agile")ed=Math.floor(ed*1.5);if(st.pet){lf("ğŸ—¿ Immune!");continue;}if(st.dodC>0&&Math.random()*100<st.dodC){lf("ğŸ’¨ Dodged!");spF("MISS!","#1abc9c","b",20);continue;}if(st.shA>0){const bl=Math.min(st.shA,ed);ed-=bl;st.shA-=bl;if(bl){lf(`ğŸ›¡ï¸ -${bl}`);spF(`ğŸ›¡-${bl}`,"#3498db","b",14);}}tD+=ed;}if(tD>0){st.hp-=tD;lf(`ğŸ’¥ ${tD} DMG!`);spF(`-${tD}`,"#e74c3c","b",24);flP("d");doSk("b");}st.enemies=st.enemies.filter(e=>e.hp>0);st.dodC=0;st.bld=false;st.pet=false;for(const trap of st.traps){const h=st.enemies.find(e=>e.hp>0);if(h){h.hp-=trap.dmg;lf(`ğŸª¤ ${trap.dmg}`);flE(h.id);}}st.traps=[];st.enemies=st.enemies.filter(e=>e.hp>0);if(st.hp<=0){st.gameO=true;lf("ğŸ’€ Defeated!");}return st;},[spF,flE,flP,doSk]);
            const hTile=useCallback(idx=>{if(!gs||gs.gameO||gs.vic||anim)return;const vm2=vMov(gs.pPos,gs.cName,gs.dblM);if(!vm2.includes(idx))return;setAnim("m");const lb=[];const bf=m=>lb.push(m);let s={...gs,floor:[...gs.floor],enemies:gs.enemies.map(e=>({...e})),traps:[...gs.traps],cons:[...gs.cons]};s.pPos=idx;s.tTrav++;s.dblM=false;const tt=s.floor[idx];const c2=cluster(s.floor,idx);const mc=c2.length;setHlT(c2);if(tt==="blank"){if(s.cName==="shieldmaiden"){s.floor[idx]="shield";bf("ğŸ›¡ï¸ Blankâ†’Shield!");spF("ğŸ›¡ï¸","#3498db","b",18);}else if(s.cName==="rogue"){s.preB+=0.3;bf(`ğŸ—¡ï¸ +${Math.round(s.preB*100)}%`);spF(`+${Math.round(s.preB*100)}%`,"#9b59b6","b",16);}else if(s.cName==="wanderer"){const d=adj(idx);if(d.length){s.pPos=pk(d);bf("ğŸ§­ Shift!");spF("ğŸ§­","#e67e22","b",16);}}else if(s.cName==="knight"){const h=Math.min(s.tTrav,5);s.hp=Math.min(s.maxHp,s.hp+h);bf(`â™ +${h}`);spF(`+${h}`,"#c0392b","b",14);flP("h");}}else if(mc>=2||(tt==="dagger"&&mc>=1)){s=rTile(s,tt,mc,bf);}else if(mc===1&&tt!=="blank"){bf(`${TT[tt]?.i} No match`);spF("No match","#555","b",13);}s.turn++;s.tL++;s=eTurn(s,bf);s=rFloor(s);if(s.enemies.length===0&&!s.gameO){const xG=50+s.level*10,gG=30+s.level*5;s.xp+=xG;s.gold+=gG;bf(`ğŸ‰ +${xG}XP +${gG}g`);spF("CLEAR!","#f1c40f","b",26);if(s.xp>=s.xpN){s.cLvl=Math.min(s.cLvl+1,3);s.xp-=s.xpN;s.xpN=Math.floor(s.xpN*1.5);const c=CLS[s.cName],li=Math.min(s.cLvl-1,2);s.maxHp=c.hp[li];s.bDmg=c.dmg[li];s.hp=s.maxHp;bf(`â¬† Lv${s.cLvl}!`);spF("â¬† LEVEL UP!","#9b59b6","b",22);}s.level++;if(s.level>10){s.vic=true;bf("ğŸ† VICTORY!");}else{s.enemies=spawnW(s.level);s.tL=0;s.shA=0;s.prB=0;s.traps=[];bf(`âš” Level ${s.level}`);sBan(`âš” LEVEL ${s.level} âš”`);}}if(s.level%3===0&&s.enemies.length>0&&s.cons.length<s.maxC){const si=Object.entries(CONS);const[key,item]=pk(si);s.cons=[...s.cons,{...item,id:uid(),key}];bf(`ğŸ ${item.i}`);}lb.forEach(m=>aLog(m));setTimeout(()=>{setHlT([]);setAnim(null);},400);setGs(s);},[gs,anim,rTile,eTurn,rFloor,aLog,spF,flP,sBan]);
            const hFort=useCallback(()=>{if(!gs||gs.gameO||anim)return;const lb=[];const bf=m=>lb.push(m);let s={...gs,enemies:gs.enemies.map(e=>({...e})),traps:[...gs.traps]};const sa=Math.floor(s.maxHp*0.1);s.shA+=sa;bf(`ğŸ° +${sa}`);spF(`ğŸ›¡+${sa}`,"#3498db","b",18);flP("s");s.turn++;s=eTurn(s,bf);s=rFloor(s);lb.forEach(m=>aLog(m));setGs(s);},[gs,anim,eTurn,rFloor,aLog,spF,flP]);
            const uCons=useCallback(idx=>{if(!gs||gs.gameO||anim)return;let s={...gs,cons:[...gs.cons],floor:[...gs.floor],enemies:gs.enemies.map(e=>({...e}))};const item=s.cons[idx];if(!item)return;s.cons.splice(idx,1);switch(item.key){case"minor_heal":{const h=Math.floor(s.maxHp*0.1);s.hp=Math.min(s.maxHp,s.hp+h);aLog(`ğŸ§ª +${h}`);spF(`+${h}`,"#27ae60","b",18);flP("h");break;}case"heal_potion":{const h=Math.floor(s.maxHp*0.2);s.hp=Math.min(s.maxHp,s.hp+h);aLog(`â¤ï¸ +${h}`);spF(`+${h}`,"#27ae60","b",20);flP("h");break;}case"swiftness":s.dblM=true;aLog("âš¡ 2Ã—!");spF("âš¡","#f1c40f","b",20);break;case"preparation":s.preB+=1;aLog("âš”ï¸ 2Ã—!");spF("2Ã— DMG","#e74c3c","b",20);break;case"incarnate":s.floor=s.floor.map(t=>t==="blank"?pk(Object.keys(TT).filter(k=>k!=="blank")):t);aLog("ğŸŒŸ Transform!");spF("âœ¨","#f1c40f","b",22);break;case"petrify":s.pet=true;aLog("ğŸ—¿ Immune!");spF("ğŸ—¿","#888","b",22);break;case"shuffle_c":s=rFloor({...s,diP:[...s.diP,...s.floor],floor:[]});aLog("ğŸ”„ Shuffle!");break;case"stunning":s.enemies.forEach(e=>e.stunned=Math.max(e.stunned,1));aLog("âš¡ Stun!");spF("âš¡STUN","#f1c40f","e",20);break;default:aLog(`Used ${item.n}`);}setGs(s);},[gs,anim,rFloor,aLog,spF,flP]);
            const buyI=useCallback(key=>{if(!gs)return;const item=CONS[key];if(gs.gold<item.p||gs.cons.length>=gs.maxC)return;let s={...gs,cons:[...gs.cons]};s.gold-=item.p;s.cons.push({...item,id:uid(),key});aLog(`ğŸ’° ${item.i}`);setGs(s);},[gs,aLog]);
            const vm=useMemo(()=>{if(!gs||gs.gameO||gs.vic)return[];return vMov(gs.pPos,gs.cName,gs.dblM);},[gs]);
            
            if(screen==="title")return(<div style={{minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"radial-gradient(ellipse at 50% 40%,hsl(30,50%,10%) 0%,#0a0a0f 70%)",fontFamily:"Georgia,serif"}}><style>{GCSS}</style><div style={{textAlign:"center",marginBottom:30}}><div style={{fontSize:64,fontWeight:900,letterSpacing:14,color:"#e8d5b7",animation:"gTitle 3s ease-in-out infinite"}}>BASELINE</div><div style={{fontSize:14,color:"#8a7a6a",letterSpacing:8,marginTop:8,textTransform:"uppercase"}}>Tile-Building Tactical Game</div></div><div style={{maxWidth:460,textAlign:"center",color:"#9a8a7a",lineHeight:1.8,fontSize:14,marginBottom:36,padding:"0 20px"}}>Build a 40-tile deck. Match adjacent symbols on a 4Ã—4 floor to attack, defend, and heal. Survive 10 enemy waves.</div><button onClick={()=>setScreen("select")} style={{background:"linear-gradient(135deg,#8b6914,#c9983a)",color:"#1a1410",border:"2px solid #c9983a",padding:"14px 48px",fontSize:18,fontWeight:700,cursor:"pointer",letterSpacing:4,borderRadius:2}}>âš” BEGIN âš”</button><div style={{marginTop:28,color:"#5a4a3a",fontSize:12,letterSpacing:2}}>Move â€¢ Match â€¢ Survive</div></div>);
            
            if(screen==="select"){const tOpts=Object.keys(TT).filter(k=>k!=="blank");const togT=t=>{if(deckC.includes(t)){if(deckC.length>2)setDeckC(deckC.filter(x=>x!==t));}else{if(deckC.length<8)setDeckC([...deckC,t]);}};return(<div style={{minHeight:"100vh",background:"#0a0a0f",padding:"36px 16px",display:"flex",flexDirection:"column",alignItems:"center",fontFamily:"Georgia,serif",color:"#ddd"}}><style>{GCSS}</style><div style={{fontSize:28,color:"#e8d5b7",fontWeight:700,marginBottom:24,letterSpacing:4}}>Choose Your Class</div><div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(200px,1fr))",gap:12,maxWidth:900,width:"100%",marginBottom:20}}>{Object.entries(CLS).map(([k,c])=>(<div key={k} onClick={()=>setSelC(k)} style={{background:"#12121c",border:`2px solid ${selC===k?c.color:"#2a2a3a"}`,borderRadius:8,padding:16,cursor:"pointer",textAlign:"center",boxShadow:selC===k?`0 0 24px ${c.color}33`:"none",transition:"all 0.3s"}}><div style={{fontSize:36}}>{c.icon}</div><div style={{fontSize:16,fontWeight:700,marginTop:6,color:c.color}}>{c.name}</div><div style={{fontSize:11,color:"#8a8a9a",marginTop:3}}>{c.moveD}</div><div style={{fontSize:11,color:"#6a6a7a",marginTop:6}}>HP:{c.hp[0]}â†’{c.hp[2]} DMG:{c.dmg[0]}â†’{c.dmg[2]}</div><div style={{fontSize:12,color:"#c9983a",marginTop:8,fontWeight:600}}>{c.spec}</div><div style={{fontSize:10,color:"#6a6a7a",marginTop:3,lineHeight:1.5}}>{c.specD}</div></div>))}</div><button onClick={()=>setShowDk(!showDk)} style={{background:"transparent",color:"#888",border:"1px solid #333",padding:"7px 22px",cursor:"pointer",fontSize:12,marginBottom:14,borderRadius:4,fontFamily:"inherit"}}>{showDk?"â–² Hide":"â–¼ Deck"}</button>{showDk&&(<div style={{background:"#12121c",border:"1px solid #2a2a3a",borderRadius:8,padding:18,maxWidth:650,width:"100%",marginBottom:18}}><div style={{color:"#aaa",fontSize:11,marginBottom:10,textAlign:"center"}}>Pick 2â€“8 tile types (40 tiles, 8 blanks)</div><div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(72px,1fr))",gap:7}}>{tOpts.map(t=>{const tt=TT[t];const sel=deckC.includes(t);return(<div key={t} onClick={()=>togT(t)} style={{display:"flex",flexDirection:"column",alignItems:"center",gap:3,padding:"8px 4px",border:`2px solid ${sel?tt.c:"#2a2a3a"}`,borderRadius:6,cursor:"pointer",background:"#0a0a12",opacity:sel?1:0.4,transition:"all 0.2s"}}><span style={{fontSize:20}}>{tt.i}</span><span style={{fontSize:9,color:"#ccc"}}>{tt.n}</span></div>);})}</div><div style={{textAlign:"center",color:"#888",fontSize:11,marginTop:10}}>Selected: {deckC.map(t=>TT[t]?.i).join(" ")}</div></div>)}<button onClick={startG} disabled={!selC} style={{background:selC?"linear-gradient(135deg,#8b6914,#c9983a)":"#333",color:selC?"#1a1410":"#666",border:`2px solid ${selC?"#c9983a":"#444"}`,padding:"12px 40px",fontSize:15,fontWeight:700,cursor:selC?"pointer":"default",letterSpacing:3,borderRadius:2,marginTop:4}}>âš” Enter Battle âš”</button></div>);}
            
            if(!gs)return null;const cd=CLS[gs.cName];const hpP=Math.max(0,(gs.hp/gs.maxHp)*100);const xpP=(gs.xp/gs.xpN)*100;
            
            return(<div style={{minHeight:"100vh",background:"#0a0a0f",color:"#ddd",fontFamily:"Georgia,serif",position:"relative"}}><style>{GCSS}</style><div style={{display:"grid",gridTemplateColumns:"220px 1fr 220px",minHeight:"100vh",animation:shake==="b"?"bShake 0.5s ease":shake==="s"?"sShake 0.3s ease":"none"}}><div style={{background:"#0d0d15",borderRight:"1px solid #1a1a2a",padding:12,display:"flex",flexDirection:"column",gap:10,overflowY:"auto"}}><div style={{background:"#10101a",borderRadius:8,padding:10,border:"1px solid #1a1a2a",animation:pFl==="h"?"healP 0.6s ease":pFl==="s"?"shieldP 0.6s ease":pFl==="d"?"dmgF 0.4s ease":"none"}}><div style={{display:"flex",gap:8,alignItems:"center",marginBottom:8}}><span style={{fontSize:22}}>{cd.icon}</span><div><div style={{color:cd.color,fontWeight:700,fontSize:13}}>{cd.name}</div><div style={{color:"#888",fontSize:10}}>Lv{gs.cLvl} Â· {gs.gold}ğŸ’°</div></div></div><div style={{fontSize:9,color:"#888",marginBottom:2}}>HP {gs.hp}/{gs.maxHp}{gs.shA>0?` (+${gs.shA}ğŸ›¡)`:""}</div><div style={{height:8,background:"#1a1a2a",borderRadius:4,overflow:"hidden",position:"relative"}}><div style={{height:"100%",width:`${hpP}%`,borderRadius:4,background:hpP>50?"#27ae60":hpP>25?"#f39c12":"#e74c3c",transition:"width 0.4s ease"}}/>{gs.shA>0&&<div style={{height:"100%",width:`${Math.min(100,(gs.shA/gs.maxHp)*100)}%`,background:"#3498db44",position:"absolute",top:0,left:`${hpP}%`,borderRadius:4,transition:"width 0.3s"}}/>}</div><div style={{fontSize:9,color:"#888",marginTop:5,marginBottom:2}}>XP {gs.xp}/{gs.xpN}</div><div style={{height:5,background:"#1a1a2a",borderRadius:3,overflow:"hidden"}}><div style={{height:"100%",width:`${xpP}%`,borderRadius:3,background:"#9b59b6",transition:"width 0.3s"}}/></div><div style={{display:"flex",flexWrap:"wrap",gap:3,marginTop:7}}>{gs.prB>0&&<span style={bT}>ğŸ™+{gs.prB}</span>}{gs.dodC>0&&<span style={bT}>ğŸ’¨{gs.dodC}%</span>}{gs.bld&&<span style={bT}>ğŸ©¸steal</span>}{gs.preB>0&&<span style={bT}>âš”ï¸+{Math.round(gs.preB*100)}%</span>}{gs.dblM&&<span style={bT}>âš¡2Ã—</span>}{gs.pet&&<span style={bT}>ğŸ—¿</span>}{gs.traps.length>0&&<span style={bT}>ğŸª¤{gs.traps.length}</span>}</div><div style={{display:"flex",justifyContent:"space-between",fontSize:10,color:"#777",marginTop:7}}><span>âš”{gs.bDmg}</span><span>ğŸ¯{gs.crit}%</span></div></div><button onClick={hFort} disabled={!!anim||gs.gameO} style={{background:"#1a2a3a",color:"#6aa",border:"1px solid #2a3a4a",padding:"7px 10px",cursor:"pointer",borderRadius:6,fontSize:12,fontFamily:"inherit",width:"100%"}}>ğŸ° Fortify (+{Math.floor(gs.maxHp*0.1)})</button><div><div style={{fontSize:9,color:"#555",textTransform:"uppercase",letterSpacing:1,marginBottom:5}}>Items ({gs.cons.length}/{gs.maxC})</div><div style={{display:"flex",gap:5,flexWrap:"wrap"}}>{gs.cons.map((c,i)=>(<div key={c.id} onClick={()=>uCons(i)} title={c.d} style={{width:52,height:46,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:1,background:"#10101a",border:"1px solid #2a2a3a",borderRadius:6,cursor:"pointer"}}><span style={{fontSize:16}}>{c.i}</span><span style={{fontSize:7,color:"#aaa"}}>{c.n}</span></div>))}{Array.from({length:gs.maxC-gs.cons.length}).map((_,i)=>(<div key={`e${i}`} style={{width:52,height:46,display:"flex",alignItems:"center",justifyContent:"center",background:"#10101a",border:"1px solid #1a1a2a",borderRadius:6,opacity:0.25}}>Â·</div>))}</div></div><div><button onClick={()=>setShopO(!shopO)} style={{background:"transparent",color:"#888",border:"1px solid #2a2a3a",padding:"4px 10px",cursor:"pointer",fontSize:10,borderRadius:4,fontFamily:"inherit",width:"100%"}}>{shopO?"â–² Close":"ğŸ’° Shop"}</button>{shopO&&(<div style={{marginTop:6,display:"grid",gridTemplateColumns:"1fr 1fr",gap:4}}>{Object.entries(CONS).map(([k,it])=>(<div key={k} onClick={()=>buyI(k)} title={it.d} style={{background:gs.gold>=it.p?"#10101a":"#0a0a0f",border:"1px solid #2a2a3a",borderRadius:4,padding:"4px 6px",cursor:gs.gold>=it.p?"pointer":"default",opacity:gs.gold>=it.p?1:0.3,display:"flex",alignItems:"center",gap:4,fontSize:10}}><span style={{fontSize:14}}>{it.i}</span><div><div style={{color:"#ccc",fontSize:9}}>{it.n}</div><div style={{color:"#c9983a",fontSize:8}}>{it.p}g</div></div></div>))}</div>)}</div><div style={{marginTop:"auto"}}><div style={{fontSize:9,color:"#555",textTransform:"uppercase",letterSpacing:1,marginBottom:4}}>Deck</div><div style={{display:"flex",justifyContent:"space-between",fontSize:11,color:"#888"}}><span>ğŸ“¥{gs.drP.length}</span><span>ğŸ“¤{gs.diP.length}</span></div></div></div><div style={{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:14,gap:12,position:"relative"}}><Floats texts={fts}/>{ban&&(<div style={{position:"absolute",top:40,zIndex:60,fontSize:28,fontWeight:900,color:"#e8d5b7",letterSpacing:6,textShadow:"0 0 30px #c9983a88,0 0 60px #c9983a44",animation:"lvlB 1.8s ease forwards"}}>{ban}</div>)}<div style={{width:"100%",maxWidth:440,minHeight:110}}>{gs.enemies.length===0?(<div style={{textAlign:"center",color:"#4a6a4a",fontSize:13,padding:20}}>âœ¨ Wave cleared!</div>):(<div style={{display:"flex",gap:8,justifyContent:"center",flexWrap:"wrap"}}>{gs.enemies.map(e=>{const hp2=Math.max(0,(e.hp/e.maxHp)*100);const mod=EMODS[e.modifier];const isH=hitE.has(e.id);const fr=e.type==="melee"?"#8b0000":"#4a0080";const gl=e.type==="melee"?"#ff4444":"#aa44ff";return(<div key={e.id} style={{background:`linear-gradient(180deg,${fr}22 0%,#14141e 100%)`,border:`1px solid ${isH?"#ff444488":fr+"44"}`,borderRadius:8,padding:"8px 12px",textAlign:"center",minWidth:90,animation:isH?"eHit 0.45s ease":"eIdle 2s ease-in-out infinite",boxShadow:isH?`0 0 16px ${gl}44`:`0 2px 8px rgba(0,0,0,0.3)`,transition:"border-color 0.2s"}}><div style={{width:50,height:50,margin:"0 auto 4px",borderRadius:6,background:`radial-gradient(circle at 50% 40%,${fr}44,#0a0a0f)`,border:`1px solid ${fr}66`,display:"flex",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden"}}><div style={{fontSize:30,filter:e.stunned>0?"grayscale(0.8) brightness(0.6)":e.burning>0?"hue-rotate(-20deg) brightness(1.3)":"none",transition:"filter 0.3s"}}>{e.type==="melee"?"ğŸ‘¹":"ğŸ§™"}</div>{e.burning>0&&<div style={{position:"absolute",bottom:0,left:0,right:0,height:14,background:"linear-gradient(transparent,#ff572244)"}}/>}{e.stunned>0&&<div style={{position:"absolute",inset:0,background:"#f1c40f11",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18}}>âš¡</div>}{mod.i&&<div style={{position:"absolute",top:1,right:1,fontSize:10}}>{mod.i}</div>}</div><div style={{fontSize:9,color:"#bbb",textTransform:"uppercase",letterSpacing:0.5,fontWeight:600}}>{e.type} {e.tier}{mod.n&&<span style={{color:mod.c,fontSize:8}}> {mod.n}</span>}</div><div style={{height:4,background:"#1a1a1a",borderRadius:2,marginTop:3,overflow:"hidden",border:"1px solid #2a2a2a"}}><div style={{height:"100%",width:`${hp2}%`,background:hp2>50?"#e74c3c":hp2>25?"#ff6b35":"#ff3333",borderRadius:2,transition:"width 0.4s",boxShadow:hp2<30?"0 0 6px #ff333366":"none"}}/></div><div style={{fontSize:8,color:"#999",marginTop:2}}>{e.hp}/{e.maxHp} Â· âš”{e.dmg}</div><div style={{fontSize:9,display:"flex",gap:3,justifyContent:"center",marginTop:1}}>{e.silenced>0&&<span>ğŸ¤«{e.silenced}</span>}{e.charging&&e.chargeT>0&&<span>â³{e.chargeT}</span>}</div></div>);})}</div>)}</div><div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:5,padding:7,background:"#08080e",borderRadius:11,border:"2px solid #1a1a2a"}}>{gs.floor.map((tile,idx)=>{const tt=TT[tile]||TT.blank;const isP=idx===gs.pPos;const isV=vm.includes(idx);const isHL=hlT.includes(idx);return(<div key={idx} onClick={()=>hTile(idx)} style={{width:82,height:82,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:7,border:`2px solid ${isP?cd.color:isHL?tt.c:isV?"#3498db33":"#1e1e30"}`,background:isP?`linear-gradient(135deg,${cd.color}33,${cd.color}15)`:isHL?`${tt.c}33`:"#13131d",cursor:isV?"pointer":"default",position:"relative",userSelect:"none",transform:isHL?"scale(1.06)":"scale(1)",transition:"transform 0.2s,border-color 0.15s,background 0.15s",zIndex:isHL?2:1,boxShadow:isHL?`0 0 12px ${tt.c}44`:"none"}}>{isP&&<div style={{fontSize:18,position:"absolute",top:1,textShadow:`0 0 10px ${cd.color}`}}>{cd.icon}</div>}<div style={{fontSize:isP?14:24,marginTop:isP?-1:0}}>{tt.i}</div>{!isP&&tile!=="blank"&&<div style={{fontSize:8,color:"#555",marginTop:1}}>{tt.n}</div>}{isV&&!isP&&<div style={{position:"absolute",bottom:5,width:6,height:6,borderRadius:"50%",background:"#3498db",animation:"pMov 1.5s infinite"}}/>}</div>);})}</div><div style={{fontSize:12,color:"#5a5a6a",letterSpacing:2,textTransform:"uppercase"}}>Level {gs.level}/10 Â· Turn {gs.turn}</div></div><div style={{background:"#0d0d15",borderLeft:"1px solid #1a1a2a",padding:12,display:"flex",flexDirection:"column"}}><div style={{fontSize:10,color:"#555",textTransform:"uppercase",letterSpacing:2,marginBottom:7,paddingBottom:7,borderBottom:"1px solid #1a1a2a"}}>Combat Log</div><div ref={logR} style={{flex:1,overflowY:"auto",paddingRight:4}}>{log.map(l=>(<div key={l.id} style={{fontSize:10,color:"#8a8a9a",padding:"2px 0",borderBottom:"1px solid #0a0a12",lineHeight:1.5,animation:"sLog 0.3s ease"}}>{l.msg}</div>))}</div><div style={{marginTop:"auto",paddingTop:10,borderTop:"1px solid #1a1a2a"}}><div style={{fontSize:9,color:"#444",textTransform:"uppercase",letterSpacing:1,marginBottom:4}}>How to Play</div><div style={{fontSize:10,color:"#666",lineHeight:1.7}}>{cd.moveD}<br/>ğŸ”µ = valid moves<br/>Click to move + activate<br/>Match 2+ adjacent = effect<br/>ğŸ° Fortify = shield + end turn</div></div></div></div>{(gs.gameO||gs.vic)&&(<div style={{position:"fixed",inset:0,background:"rgba(0,0,0,0.88)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:100}}><div style={{background:"#12121c",border:"2px solid #c9983a",borderRadius:12,padding:36,textAlign:"center",maxWidth:380}}><div style={{fontSize:32,fontWeight:900,color:"#e8d5b7",letterSpacing:4,marginBottom:16}}>{gs.vic?"ğŸ† VICTORY!":"ğŸ’€ DEFEAT"}</div><div style={{fontSize:13,color:"#8a8a9a",lineHeight:2.2,marginBottom:20}}>Level: {gs.level}{gs.vic?" (cleared!)":""}<br/>Turns: {gs.turn}<br/>{cd.name} Lv{gs.cLvl}<br/>{gs.gold}ğŸ’°</div><button onClick={()=>{setScreen("title");setGs(null);setFts([]);}} style={{background:"linear-gradient(135deg,#8b6914,#c9983a)",color:"#1a1410",border:"2px solid #c9983a",padding:"11px 32px",fontSize:15,fontWeight:700,cursor:"pointer",letterSpacing:3,borderRadius:2}}>Play Again</button></div></div>)}</div>);
        }
        
        const bT={fontSize:9,background:"#1a1a2a",border:"1px solid #2a2a3a",padding:"1px 5px",borderRadius:3,color:"#ccc",display:"inline-block"};

        ReactDOM.render(<BaselineGame />, document.getElementById('root'));
    </script>
</body>
</html>